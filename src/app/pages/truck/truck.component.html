<!-- ======= TOAST NOTIFICATION ======== -->
<p-toast></p-toast>

<!-- ======== CONFIRM POP-UP======== -->
<p-confirmPopup></p-confirmPopup>

<app-content-header [title]="'Profile / Truck'"></app-content-header>
 

<div class="text-center my-3" *ngIf="isLoading">
    <app-loader></app-loader>
</div>

<p-messages 
    [(value)]="truckError" 
    [enableService]="false" 
    [closable]="false"
    *ngIf="truckError" 
/>

<!-- ======= TABLE ======= -->
<div class="table" *ngIf="!isLoading && truckError.length === 0">

    <p-table  
        #dt1 
        [value]="filteredTrucks" 
        [tableStyle]="{ 'width': '100%'}" 
        [globalFilterFields]="['TruckingName', 'TruckType', 'PlateNo', 'Description']" 
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[5, 10, 20]"
    >

        <ng-template pTemplate="caption">
            <div class="flex align-items-center justify-content-between mb-2">

                <!-- <input 
                    pInputText 
                    type="text" 
                    class="p-inputtext-lg pl-3 input__search" 
                    placeholder="Search" 
                    (input)="onGlobalFilter(dt1, $event)"
                /> -->

                <button 
                    pButton 
                    pRipple 
                    class="add__btn" 
                    (click)="showDialog()"
                    *ngIf="insert"
                >
                    <i class='bx bx-plus'></i> 
                    <span>Add Item</span>
                </button>

                <input 
                    pInputText 
                    type="text" 
                    class="p-inputtext-lg pl-3 input__search" 
                    placeholder="Search" 
                    [(ngModel)]="searchText"
                    (input)="onSearchChange()"
                />

                <!-- <button (click)="applyFilter(2)">Add params</button> -->

            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr class="thead">
                <th>#</th>
                <th pSortableColumn="PlateNo" >   
                    Plate No
                    <p-sortIcon field="PlateNo" />
                </th>
                <!-- <th pSortableColumn="TruckingName" >   
                    Trucking
                    <p-sortIcon field="TruckingName" />
                </th> -->
                <th style="min-width:15rem">
                    <div class="flex align-items-center">
                        Trucking
                        <p-columnFilter 
                            field="TruckingName" 
                            matchMode="in" 
                            display="menu" 
                            [showMatchModes]="false" 
                            [showOperator]="false" 
                            [showAddButton]="false"
                            [showApplyButton]="false"
                        >
                            <ng-template pTemplate="header">
                                <div class="px-3 pt-3 pb-0">
                                    <span class="font-bold">Trucking Picker</span>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-multiSelect 
                                    [ngModel]="value" 
                                    [options]="trucking" 
                                    optionValue="TruckingName"
                                    optionLabel="TruckingName"
                                    placeholder="Select" 
                                    (onChange)="filter($event.value)" 
                                >
                                    <ng-template let-option pTemplate="item">
                                        <div class="inline-block vertical-align-middle">
                                            <span class="ml-1 mt-1">{{ option.TruckingName }}</span>
                                        </div>
                                    </ng-template>
                                </p-multiSelect>
                            </ng-template>
                        </p-columnFilter>
                    </div>
                </th>
                <th pSortableColumn="Description" >   
                    Description
                    <p-sortIcon field="Description" />
                </th>
                <th *ngIf="edit"></th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
            <tr>
                <td data-title="#">{{ rowIndex + 1 }}</td>
                <td data-title="PlateNo">{{ row.PlateNo }}</td>
                <td data-title="Trucking Name">{{ row.TruckingName }}</td>
                <!-- <td data-title="Truck Type">{{ row.TruckType }}</td> -->
                <td data-title="Description">{{ row.Description == null ? '-' : row.Description }}</td>
                <td data-title="Actions" *ngIf="edit">
                    <!-- <button pButton pRipple class="edit__btn" (click)="onSelect(row)" class="p-button-success p-2 border-round mr-2"><i class='bx bx-edit-alt'></i></button>
                    <button pButton pRipple class="delete__btn" class="p-button-danger p-2 border-round" (click)="confirm2($event, row.TruckID)"><i class='bx bx-trash' ></i></button> -->
                    <i class="pi pi-ellipsis-v cursor-pointer hover:text-indigo-500 p-2 border-circle" (click)="action.toggle($event)"></i>
                    <p-overlayPanel #action>
                    <div class="actions-overlay">
                        <p (click)="onSelect(row)">
                            <svg  width="15px" height="15px">
                                <use href="assets/icons/icon-file-edit.svg#Layer_1"></use>
                            </svg>
                            Edit
                        </p>
                        <p (click)="confirm2($event, row.TruckID)">
                            <svg  width="15px" height="15px">
                                <use href="assets/icons/icon-file-delete.svg#delete"></use>
                            </svg>
                            Delete
                        </p>
                    </div>
                    </p-overlayPanel>
                </td>
            </tr>
        </ng-template>

    </p-table>

</div>


<!-- ========= MODAL FORM ========== -->
<p-dialog 
    header="{{dialogHeader}}" 
    [(visible)]="visible" 
    [modal]="true" 
    [breakpoints]="{ '1200px': '500px' }" 
    [style]="{ width: '35vw' }" 
    [draggable]="false" 
    [resizable]="false"
>
    <form 
        [formGroup]="truckForm" 
        class="p-fluid" 
        (ngSubmit)="onSubmit()"
    >  

        <div class="field">
            <label class="font-semibold" >Plate No</label>
            <input 
                pInputText 
                formControlName="PlateNo" 
                autocomplete="off" 
                class="input" 
                placeholder="Enter place #"
            >
        </div>

        <div class="field">
            <label class="font-semibold" >Trucking</label>
            <!-- <div class="card flex justify-content-center"> -->
                <p-dropdown 
                    [options]="trucking" 
                    formControlName="TruckingID" 
                    optionLabel="TruckingName" 
                    [filter]="true"
                    filterBy="TruckingName" 
                    [style]="{'height': '40px', 'border': '1px solid white'}" 
                    [showClear]="true" 
                    placeholder="Select Trucking" 
                    optionValue="TruckingID"
                    appendTo="body"
                ></p-dropdown>
            <!-- </div> -->
        </div>

        <!-- <div class="field">
            <label class="font-semibold" >Truck Type</label>
            <div class="card flex justify-content-center">
                <p-dropdown 
                    [options]="truckType" 
                    formControlName="TruckTypeID" 
                    optionLabel="TruckType" 
                    [style]="{'height': '40px', 'border': '1px solid white'}" 
                    [showClear]="true" 
                    placeholder="Select Truck Type" 
                    optionValue="TruckTypeID"
                    appendTo="body"
                ></p-dropdown>
            </div>
        </div> -->

        <div class="field">
            <label class="font-semibold" >Description</label>
            <input 
                pInputText 
                formControlName="Description" 
                autocomplete="off" 
                class="input"
            >
        </div>

        <div class="flex justify-content-end gap-2">
            <app-submit-button 
                [submitLoading]="submitLoading" 
                [form]="truckForm" 
            /> 
        </div>

    </form>
</p-dialog>